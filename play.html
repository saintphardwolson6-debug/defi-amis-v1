<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Joue le D√©fi</title>
  <link rel="stylesheet" href="style.css">
</head>
<body class="fade-in">
  <div class="container">
    <h2 id="title"></h2>
    <div id="questions"></div>
    <input type="text" id="friendName" placeholder="Ton nom..." />
    <button id="submitBtn">Valider mes r√©ponses</button>
    <div id="result" class="hidden"></div>
  </div>

  <script>
    const params = new URLSearchParams(window.location.search);
    const user = params.get("user");
    const uid = params.get("uid");

    document.getElementById("title").textContent = `D√©fi de ${user} üéØ`;

    const questions = [
      { q: `Le plat pr√©f√©r√© de ${user} ?`, options: ["Pizza", "Burger", "Riz", "P√¢tes"] },
      { q: `Le sport pr√©f√©r√© de ${user} ?`, options: ["Football", "Basket", "Tennis", "Natation"] },
      { q: `L‚Äôanimal pr√©f√©r√© de ${user} ?`, options: ["Chien", "Chat", "Oiseau", "Lion"] },
      { q: `La couleur pr√©f√©r√©e de ${user} ?`, options: ["Rouge", "Bleu", "Noir", "Vert"] },
      { q: `Le r√™ve le plus fou de ${user} ?`, options: ["Voyager", "√ätre riche", "C√©l√©brit√©", "Dormir"] },
    ];

    const qContainer = document.getElementById("questions");
    questions.forEach((q, i) => {
      qContainer.innerHTML += `
        <div class="question-block">
          <p>${q.q}</p>
          ${q.options.map(opt => `
            <label><input type="radio" name="q${i}" value="${opt}"> ${opt}</label>
          `).join("")}
        </div>`;
    });

    document.getElementById("submitBtn").addEventListener("click", () => {
      const answers = JSON.parse(localStorage.getItem(`answers_${uid}`));
      const friend = document.getElementById("friendName").value.trim();
      if (!friend) return alert("Entre ton nom !");
      let score = 0;
      questions.forEach((_, i) => {
        const selected = document.querySelector(`input[name="q${i}"]:checked`);
        if (selected && selected.value === answers[i]) score++;
      });

      let leaderboard = JSON.parse(localStorage.getItem(`leaderboard_${uid}`) || "[]");
      leaderboard.push({ name: friend, score });
      localStorage.setItem(`leaderboard_${uid}`, JSON.stringify(leaderboard));

      let html = `<h3>Classement des amis de ${user}</h3><ul>`;
      leaderboard.sort((a,b) => b.score - a.score).forEach(p => {
        html += `<li>${p.name} : ${p.score}/5</li>`;
      });
      html += "</ul>";

      document.getElementById("result").innerHTML = html + `<br><button onclick="window.location='index.html'">Cr√©er ton d√©fi</button>`;
      document.getElementById("result").classList.remove("hidden");
    });
  </script>
</body>
</html>