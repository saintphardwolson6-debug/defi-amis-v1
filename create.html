<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>DÃ©fi Amis â€” CrÃ©er</title>
<link rel="stylesheet" href="style.css" />
</head>
<body class="bg">
<main class="card">
  <div class="top">
    <button class="back" onclick="location.href='index.html'">â† Accueil</button>
  </div>

  <h2 id="title">CrÃ©er ton dÃ©fi</h2>
  <p class="muted" id="subtitle"></p>

  <div id="qList"></div>
  <div class="row">
    <button id="btnFinish" class="btn primary">Terminer & GÃ©nÃ©rer mon dÃ©fi</button>
  </div>

  <div id="shareBox" class="created hidden">
    <h3>Ton dÃ©fi est prÃªt ğŸ‰</h3>
    <p>UID : <span id="uidText"></span></p>
    <input id="shareLink" readonly />
    <div class="socials">
      <a id="wa" class="icon"><img src="https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/svg/1f4f2.svg" width="25"></a>
      <a id="fb" class="icon"><img src="https://cdn-icons-png.flaticon.com/512/124/124010.png" width="25"></a>
      <a id="copy" class="icon"><img src="https://cdn-icons-png.flaticon.com/512/1828/1828919.png" width="25"></a>
    </div>
    <button id="gotoPlay" class="btn primary">Voir mon dÃ©fi</button>
  </div>
</main>

<script>
const QUESTIONS = [
  "Quel est ton plat prÃ©fÃ©rÃ© ?",
  "Quel est ton sport prÃ©fÃ©rÃ© ?",
  "Quel est ton animal prÃ©fÃ©rÃ© ?",
  "Quelle est ta couleur prÃ©fÃ©rÃ©e ?",
  "Quel est ton rÃªve le plus fou ?"
];

function genUID(seed='USER'){
  const s = (seed||'USER').toUpperCase().replace(/[^A-Z0-9]+/g,'').slice(0,6)||'USER';
  return `${s}-${Math.random().toString(36).slice(2,7).toUpperCase()}`;
}

const params = new URLSearchParams(location.search);
const uid = params.get('uid') || genUID();
const key = `room_${uid}`;
let host = localStorage.getItem('creatorName') || 'HÃ´te';

document.getElementById('subtitle').textContent = `RÃ©ponds Ã  ces 5 questions sur toi.`;
const qList = document.getElementById('qList');
QUESTIONS.forEach((q,i)=>{
  const div = document.createElement('div');
  div.className = 'question';
  div.innerHTML = `<label>${i+1}. ${q}</label><input type="text" id="a${i}" placeholder="Ta rÃ©ponse..." />`;
  qList.appendChild(div);
});

document.getElementById('btnFinish').addEventListener('click', ()=>{
  const answers = QUESTIONS.map((_,i)=> document.getElementById(`a${i}`).value.trim());
  if(answers.some(a=>!a)){ alert("RÃ©ponds Ã  toutes les questions ğŸ˜‰"); return; }

  const room = {
    host, uid, answers, players: [], createdAt: new Date().toISOString()
  };
  localStorage.setItem(key, JSON.stringify(room));
  localStorage.setItem('lastCreatedUID', uid);

  const base = location.origin + location.pathname.replace(/\/[^/]*$/,'/');
  const link = `${base}play.html?uid=${uid}`;
  document.getElementById('uidText').textContent = uid;
  document.getElementById('shareLink').value = link;
  document.getElementById('shareBox').classList.remove('hidden');

  document.getElementById('wa').href = `https://wa.me/?text=${encodeURIComponent('Viens deviner mes rÃ©ponses ğŸ˜ğŸ‘‰ ' + link)}`;
  document.getElementById('fb').href = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(link)}`;
  document.getElementById('copy').addEventListener('click', ()=>{navigator.clipboard.writeText(link);alert('Lien copiÃ© âœ…');});
  document.getElementById('gotoPlay').addEventListener('click', ()=>location.href=`play.html?uid=${uid}`);
});
</script>
</body>
</html>